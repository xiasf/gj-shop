<!DOCTYPE html >
<html>
<head>
    <meta name="Generator" content="gjshop v1.1" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>商家详情</title>
    <meta http-equiv="keywords" content="{$gjshop_config['shop_info_store_keyword']}" />
    <meta name="description" content="{$gjshop_config['shop_info_store_desc']}" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <link rel="stylesheet" type="text/css" href="__STATIC__/css/public.css?v=20161130040319"/>
    <link rel="stylesheet" type="text/css" href="__STATIC__/css/index.css?v=20161130040319"/>
    <link rel="stylesheet" type="text/css" href="__STATIC__/IconFont/iconfont.css?v=20161130040319"/>
    <script type="text/javascript" src="__STATIC__/js/jquery.js"></script>
    <script type="text/javascript" src="__STATIC__/js/TouchSlide.1.1.js"></script>
    <script type="text/javascript" src="__STATIC__/js/jquery.json.js"></script>
    <script type="text/javascript" src="__STATIC__/js/touchslider.dev.js"></script>
    <script type="text/javascript" src="__STATIC__/js/layer.js" ></script>
    <script src="__PUBLIC__/js/global.js"></script>
    <script src="__PUBLIC__/js/mobile_common.js"></script>
    <script type="text/javascript" src="__STATIC__/js/layer.mobile-v2.0/layer_mobile/layer.js" ></script>
    <style>
        .small {
            font-size: 1.2rem;
            padding-left: 11px;
            color: #929292;
        }
        .shop-info li {
            padding: 1px 7px;
            font-size: 1.4rem;
            border-bottom: 1px #E0E0E0 solid;
        }
        .shop-info strong {
            font-weight: 100;
            color: #5A5A5A;
        }
        .shop-info .describe {
            line-height: 2.2rem;
        }
        .f {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
        }
        .f a {
            display: block;
            padding: 10px;
            font-size: 1.5rem;
            color: #fff;
            background-color: #28A25E;
            text-align: center;
        }

        #img_logo {
            width: 100%;
            height: 260px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }
        #img_logo .hou {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 2.5rem;
            height: 2.5rem;
            line-height: 2.6rem;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.72);
            color: #FFF;
            font-size: 1.2rem;
            border-radius: 50px;
            opacity: .8;
        }
        #img_logo .hou i {
        font-size: 1.2rem;
        position: relative;
        left: -1px;
        }
    </style>
</head>
<body>

    <div id="img_logo" style="background-image: url('{$info.head_pic}');"><a href="javascript:history.back(-1)" onclick="" class="hou"><i class="icon iconfont icon-qiehuanqizuo"></i></a></div>

    <div class="shop-info">
        <ul>
            <li> <strong>商家：</strong>
                {$info.seller_name}
            </li>
            <li> <strong>联系人：</strong>
                {$info.contact_name}
            </li>
            <li> <strong>电话：</strong>
                {$info.mobile}
            </li>
            <li>
                <strong>地址：</strong>
                {$info.address}
            </li>
            <li>
                <strong>经营范围：</strong>
                {$info.business_scope}
            </li>
            <li>
                <strong>折扣：</strong>
                {$info['discount'] / 10}折<span class="small">消费金额的{$info['discount']}%</span>
            </li>
            <li>
                <strong>兑币抵扣：</strong>
                {$info['exchange']}%<span class="small">最高抵扣消费金额的{$info['exchange']}%</span>
            </li>
            <li class="describe">{$info['describe']}</li>
        </ul>
    </div>

    <div style="height: 56px;"></div>

    <div class="f">
        <!-- <a href="{:U('zf', ['id' => $info['id']])}">优惠支付</a> -->
        <a href="javascript:zf();">优惠支付</a>
    </div>


    <style>
        #zf-main {
            text-align: center;
        }
        .title h1 {
            font-size: 1.8rem;
            border-bottom: 1px #DCDCDC solid;
            line-height: 50px;
            height: 50px;
            font-family: '微软雅黑';
        }
        .zf-info {
            margin-top: 10px;
        }
        .zf-info li {
            margin: 16px 0;
        }

        .zf-info label {
            font-size: 1.5rem;
            height: 30px;
            line-height: 35px;
            font-family: '微软雅黑';
        }

        .zf-info input {
            border: 1px #29CA5A solid;
            padding: 10px;
            border-width: 0 0 1px 0;
            font-family: '微软雅黑';
            font-size: 1.5rem;
        }
        #pay_button {
            padding: 17px 0;
            font-size: 1.6rem;
            color: #fff;
            background-color: #28A25E;
            border: 0;
            font-family: '微软雅黑';
            display: block;
            width: 100%;
            text-align: center;
        }
        #total_amount_ {
            color: red;
            border: 0;
            background-color: #F1F1F1;
        }
    </style>
    <div id="zf-main-wrap" class="hide">
        <div id="zf-main">
            <div class="title">
                <h1>{$info.seller_name}({$info['discount'] / 10}折)</h1>
            </div>
            <form name="cart2_form" id="cart2_form" method="post">
                <input type="hidden" value="{$info.id}" name="shop_id" />
                <input type="hidden" value="{$info.discount}" name="discount" />
                <input type="hidden" value="{$info.exchange}" name="exchange_" />
                <input type="hidden" value="{$info.order_amount}" id="order_amount" name="order_amount" />
                <section class="zf-info">
                    <ul class="zf-list-info ct-list">
                        <li>
                            <label>
                                支付金额：
                                <input name="total_amount" onchange="ajax_order_price();" type="text" placeholder="请输入消费金额" >
                            </label>
                        </li>
                        <li>
                            <label>
                                优惠金额：
                                <input id="total_amount_" disabled="true" type="text" placeholder="根据消费自动计算优惠" >
                            </label>
                        </li>
                        <li>
                            <label>
                                使用兑币：
                                <input id="exchange_val" name="exchange" onchange="ajax_order_price();" type="text" value="{$user.exchange}" >
                            </label>
                        </li>
                        <li>
                            <label>我的兑币{$user.exchange}个</label>
                        </li>
                        <li>
                            <label id="exchange_info"></label>
                        </li>
                        <li></li>
                    </ul>
                </section>
            </form>

            <div class="f">
                <button onClick="submit_order();" id ="pay_button">请先输入金额</button>
            </div>
        </div>
    </div>
    <script>


        // 获取订单价格
        function ajax_order_price()
        {

            if (!$('[name=total_amount]').val()) {
                layer.open({
                    content: '请输入消费金额'
                    ,skin: 'msg'
                    ,time: 2
                });
                return false;
            }

            // 显示加载层
            var load = layer.open({
                type: 2,
                shadeClose: false,
            });

            $.ajax({
                type : "POST",
                url:'/Mobile/Union/cp_order/act/order_price/t/' + Math.random(),
                data : $('#cart2_form').serialize(),
                dataType: "json",
                success: function(data){
                    layer.close(load);  // 加载完成
                    if(data.status != 1) {
                        layer.open({
                            content: data.msg
                            ,btn: '我知道了'
                            ,yes: function(index){
                                layer.close(index);
                                // 页面信息过时/发生变动了需要重新刷新页面哦
                                if(data.status == -1)
                                    window.location.reload();
                            }
                        });
                        // 登录超时
                        if(data.status == -100)
                            window.location.href ="{:U('Mobile/User/login')}";

                        return false;
                    }
                    $("#pay_button").text('还需支付' + data.result.order_amount + '元');
                    $("#order_amount").val(data.result.order_amount);

                    $("#exchange_info").text('本次最多可使用兑币' + data.result.exchange_max + '个');

                    $("#total_amount_").val('-' + data.result.total_amount_);

                    $('#exchange_val').val(data.result.exchange);
                }
            });
        }


        // 提交订单
        ajax_return_status = 1; // 标识ajax 请求是否已经回来 可以进行下一次请求
        function submit_order()
        {

            if (!$('[name=total_amount]').val()) {
                layer.open({
                    content: '请输入消费金额'
                    ,skin: 'msg'
                    ,time: 2
                });
                return false;
            }


            // 显示加载层
            var load = layer.open({
                type: 2,
                shadeClose: false,
            });

            if(ajax_return_status == 0) return false;
            ajax_return_status = 0;
            $.ajax({
                type : "POST",
                url:"{:U('Mobile/Union/cp_order/act/submit_order/t/')}" + Math.random(),
                data : $('#cart2_form').serialize(),// 你的formid
                dataType: "json",
                success: function(data){
                    ajax_return_status = 1; // 上一次ajax 已经返回, 可以进行下一次 ajax请求
                    layer.close(load);  // 加载完成
                    if(data.status != '1')
                    {
                        layer.open({
                            content: data.msg
                            ,btn: '我知道了'
                            ,end: function(index){
                                layer.close(index);
                                // 页面信息过时/发生变动了需要重新刷新页面哦
                                if(data.status == -1)
                                    window.location.reload();
                            }
                        });

                        // 登录超时
                        if(data.status == -100) location.href ="{:U('Mobile/User/login')}";

                        return false;
                    }

                    layer.open({
                        content: data.msg
                        ,btn: 'OK'
                        ,yes: function(index){
                            layer.close(index);
                            location.href = "/index.php?m=Mobile&c=Union&a=order&order_id="+data.result;
                        }
                    });
                }
            });
        }
    </script>

    <script>
        var content_ = '';
        function zf() {
            var content = $('#zf-main-wrap').html();
            layer.open({
                type: 1
                // ,className:'x'
                ,content: content ? content : content_
                ,anim: 'up'
                ,style: 'position:fixed; bottom:0; left:0; width: 100%; height: 400px; border:none;'
                ,success : function() {
                    // 没有图层销毁前的的事件，这样每次输入都会被重置的
                    content_ = $('#zf-main').prop("outerHTML");
                }
            });
            $('#zf-main-wrap').remove();

            $('input[name="total_amount"]').click(function() {
                $('.layui-m-layerchild').css('bottom', '-126px');
            }).focus(function() {
                $('.layui-m-layerchild').css('bottom', '-126px');
            }).blur(function() {
                $('.layui-m-layerchild').css('bottom', '0');
            });
        }

        $(function(){
        });
    </script>

</body>
</html>