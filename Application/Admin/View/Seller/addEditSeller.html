<include file="Public/min-header"/>
<link href="__PUBLIC__/plugins/daterangepicker/daterangepicker-bs3.css?v=20161130040319" rel="stylesheet" type="text/css" />
<script src="__PUBLIC__/plugins/daterangepicker/moment.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/plugins/daterangepicker/daterangepicker.js" type="text/javascript"></script>


<style>
    .union {
        display: none;
    }
</style>

<div class="wrapper">
    <include file="Public/breadcrumb"/>
    <section class="content ">
        <!-- Main content -->
        <div class="container-fluid">
            <div class="pull-right">
                <a href="javascript:history.go(-1)" data-toggle="tooltip" title="" class="btn btn-default" data-original-title="返回"> <i class="fa fa-reply"></i>
                </a>
                <a href="javascript:;" class="btn btn-default" data-url="http://www.gj-shop.cn/Doc/Index/article/id/1012/developer/user.html" onclick="get_help(this)"> <i class="fa fa-question-circle"></i>
                    帮助
                </a>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <i class="fa fa-list"></i>
                        店铺管理
                    </h3>
                </div>
                <div class="panel-body ">
                    <!--表单数据-->
                    <form method="post" id="handleposition" action="">
                        <!--通用信息-->
                        <div class="tab-content col-md-10">
                            <div class="tab-pane active" id="tab_tongyong">
                                <table class="table table-bordered">
                                    <tbody>
                                        <tr>
                                            <td class="col-sm-2">店铺名称：</td>
                                            <td class="col-sm-8">
                                                <input type="text" class="form-control" name="seller_name" value="{$info.seller_name}" >
                                                <span id="err_attr_name" style="color:#F00; display:none;"></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="col-sm-2">联系人：</td>
                                            <td class="col-sm-8">
                                                <input type="text" class="form-control" name="contact_name" value="{$info.contact_name}" >
                                                <span id="err_attr_name" style="color:#F00; display:none;"></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="col-sm-2">经营范围：</td>
                                            <td class="col-sm-8">
                                                <input type="text" class="form-control" name="business_scope" value="{$info.business_scope}" >
                                                <span id="err_attr_name" style="color:#F00; display:none;"></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="col-sm-2">邮箱：</td>
                                            <td class="col-sm-8">
                                                <input type="text" class="form-control" name="email" value="{$info.email}" >
                                                <span id="err_attr_name" style="color:#F00; display:none;"></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="col-sm-2">手机号：</td>
                                            <td class="col-sm-8">
                                                <input type="text" class="form-control" name="mobile" value="{$info.mobile}" >
                                                <span id="err_attr_name" style="color:#F00; display:none;"></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="col-sm-2">密码：</td>
                                            <td class="col-sm-8">
                                                <input type="password" class="form-control" name="password" value="" placeholder="留空则不修改密码" >
                                                <span id="err_attr_name" style="color:#F00; display:none;"></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>店铺类型：</td>
                                            <td>
                                                <select name="type" class="input-sm" onchange="type_change(this)">
                                                    <option value="0" <if condition="$info[type] eq 0">selected</if>
                                                    >商城
                                                    </option>
                                                    <option value="1" <if condition="$info[type] eq 1">selected</if>
                                                    >异业联盟
                                                    </option>
                                                </select>
                                            </td>
                                        </tr>

                                <tr class="union">
                                    <td class="col-sm-2">折扣：</td>
                                    <td class="col-sm-8">
                                        <input type="text" class="form-control" name="discount" value="{$info.discount}" placeholder="消费金额的百分比，填写1~100，90表示九折，0和100表示不打折">
                                        <span id="err_attr_name" style="color:#F00; display:none;"></span>
                                    </td>
                                </tr>

                                <tr class="union">
                                    <td>店铺分类：</td>
                                    <td>
                                        <select name="category" class="input-sm">
                                            <option value="0" <if condition="$info[category] eq 0">selected</if>
                                            >美食
                                            </option>
                                            <option value="1" <if condition="$info[category] eq 2">selected</if>
                                            >电影
                                            </option>
                                            <option value="2" <if condition="$info[category] eq 3">selected</if>
                                            >酒店
                                            </option>
                                            <option value="3" <if condition="$info[category] eq 4">selected</if>
                                            >休闲娱乐
                                            </option>
                                            <option value="4" <if condition="$info[category] eq 5">selected</if>
                                            >足疗按摩
                                            </option>
                                            <option value="5" <if condition="$info[category] eq 6">selected</if>
                                            >KTV
                                            </option>
                                            <option value="6" <if condition="$info[category] eq 1">selected</if>
                                            >丽人
                                            </option>
                                            <option value="7" <if condition="$info[category] eq 7">selected</if>
                                            >其他
                                            </option>
                                        </select>
                                    </td>
                                </tr>

                                <tr class="union">
                                    <td class="col-sm-2">可抵兑币：</td>
                                    <td class="col-sm-3">
                                        <input type="text" class="form-control" name="exchange" value="{$info.exchange}" placeholder="消费金额的百分比，填写1~100，90表示九折，0和100表示不能使用兑币">
                                        <span id="err_attr_name" style="color:#F00; display:none;"></span>
                                    </td>
                                </tr>

                                <tr>
                                    <td class="col-sm-2">经纬度：</td>
                                    <td class="col-sm-10">
                                        <a class="btn btn-default" id="show-map">拾取坐标</a>
                                        <div class="col-xs-2">
                                            <input type="text" class="form-control" name="longitude" value="{$info.longitude}">
                                            <span id="err_attr_name" style="color:#F00; display:none;"></span>
                                        </div>
                                        <div class="col-xs-2">
                                            <input type="text" class="form-control" name="latitude" value="{$info.latitude}">
                                            <span id="err_attr_name" style="color:#F00; display:none;"></span>
                                        </div>
                                        <div id="milkMap"></div>
                                    </td>
                                </tr>

                        <tr>
                            <td>所在地址：</td>
                            <td colspan="2">
                                <div class="col-xs-2">
                                    <select onchange="get_city(this)" id="province" name="province" class="form-control" style="margin-left:-15px;">
                                        <option  value="0">选择省份</option>
                                        <volist name="province" id="vo">
                                            <option value="{$vo.id}" <if condition="$info[province] eq $vo[id]">selected</if>
                                            >{$vo.name}
                                        </option>
                                    </volist>
                                </select>
                            </div>
                            <div class="col-xs-2">
                                <select onchange="get_area(this)" id="city" name="city" class="form-control">
                                    <option value="0">选择城市</option>
                                    <volist name="city" id="vo">
                                        <option value="{$vo.id}" <if condition="$info[city] eq $vo[id]">selected</if>
                                        >{$vo.name}
                                    </option>
                                </volist>
                            </select>
                        </div>
                        <div class="col-xs-2">
                            <select id="district" name="district" class="form-control">
                                <option value="0">选择区域</option>
                                <volist name="area" id="vo">
                                    <option value="{$vo.id}" <if condition="$info[district] eq $vo[id]">selected</if>
                                    >{$vo.name}
                                </option>
                            </volist>
                        </select>
                    </div>
                    <div class="col-xs-4">
                        <input type="text" placeholder="详细地址" class="form-control" name="address" value="{$info.address}">
                    </div>
                </td>
            </tr>
            <tr>
                <td>店铺图片：</td>
                <td>
                    <div class="col-sm-3">
                        <input type="text" class="form-control" style="width:350px;margin-left:-15px;" name="head_pic" id="head_pic" value="{$info.head_pic}" ></div>
                    <div class="col-sm-3">
                        <input type="button" class="btn btn-default" onClick="GetUploadify(1,'head_pic','ad','')"  value="上传图片"/>
                    </div>
                </td>
            </tr>
            <tr>
                <td>默认排序：</td>
                <td>
                    <input type="text" class="input-sm" name="sort" value="{$info.sort}"  placeholder="50"></td>
            </tr>
            <tr>
                <td>简介：</td>
                <td>
                    <textarea name="describe">{$info.describe}</textarea>
                </td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <input type="hidden" name="id" value="{$info.id}"></tr>
            <td class="text-right">
                <input class="btn btn-primary" type="button" onclick="adsubmit()" value="保存"></td>
        </tfoot>
    </table>
</div>
</div>
</form>
<!--表单数据-->
</div>
</div>
</div>
</section>
</div>

<style type="text/css">
    #milkMap{
        height:540px;width:100%;
        -webkit-box-shadow: 0px 1px 5px #757575;
        border-radius: 8px;
        /*display: none;*/
    }
</style>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=9Go7FByT2xPEH5VcPKMiZWoY"></script>

<script>
function adsubmit(){
    $('#handleposition').submit();
}

$(document).ready(function() {

    if ($('select[name=type]').val() == 1) {
        $('.union').show();
    } else {
        $('.union').hide();
    }

    $('#show-map').click(function() {
        $('#milkMap').css({'width':'100%','height':'100%'});
        layer.open({
          type: 1,
          skin: 'layui-layer-rim', //加上边框
          area: ['80%', '540px'], //宽高
          content: $('#milkMap')
        });
    });

    var map = new BMap.Map("milkMap");              // 创建地图实例
    var point = new BMap.Point({: $info['longitude'] ? : '114.880453'}, {: $info['latitude'] ? : '30.465399'});  // 创建点坐标
    map.centerAndZoom(point, 14);                 // 初始化地图，设置中心点坐标和地图级别
    // var myIcon = new BMap.Icon("http://www.iconpng.com/png/mapmarkers/bubble_pink.png", new BMap.Size(300,157));

    creMarker(point);

    function creMarker(point) {
        marker = new BMap.Marker(point);        // 创建标注  
    　　map.addOverlay(marker);                 // 将标注添加到地图中
        marker.enableDragging();
    }

    function showInfo(e) {
        map.removeOverlay(marker);
        var point =new BMap.Point(e.point.lng, e.point.lat);
        creMarker(point);
        coordinates(e);
    }

    // 单击事件
    map.addEventListener("click", showInfo);

    marker.addEventListener("dragend", coordinates);

    // 移动地图时的事件
    map.addEventListener('ondragging', function(e){
        marker.setPosition(map.getCenter());
        // 直接用这个可能会导致页面卡主html冗积太多
        // coordinates(e);
        $('input[name=longitude]').val(e.point.lng);
        $('input[name=latitude]').val(e.point.lat);
    });

    // 移动地图完成的事件
    map.addEventListener('dragend', function(e){
        marker.setPosition(map.getCenter());
        coordinates(e);
    });

    function coordinates(e) {
        var p = marker.getPosition();
        map.panTo(p);
        var geo = new BMap.Geocoder();
        geo.getLocation(p, function(addr){
            $('input[name=address]').val(addr.address);
            var address_reference = addr.surroundingPois[0] ? addr.surroundingPois[0]['title'] : '';
            // $('input[name=address_reference]').val(address_reference);
            $('input[name=address]').val($('input[name=address]').val() + ' ' + address_reference);
        });

        $('input[name=longitude]').val(e.point.lng);
        $('input[name=latitude]').val(e.point.lat);
    }


    // 添加带有定位的导航控件
    var navigationControl = new BMap.NavigationControl({
        // 靠左上角位置
        anchor: BMAP_ANCHOR_TOP_LEFT,
        // LARGE类型
        type: BMAP_NAVIGATION_CONTROL_LARGE,
        // 启用显示定位
        enableGeolocation: true
    });
    map.addControl(navigationControl);
    // 添加定位控件
    var geolocationControl = new BMap.GeolocationControl();
    geolocationControl.addEventListener("locationSuccess", function(e){
    // 定位成功事件
    var address = '';
    address += e.addressComponent.province;
    address += e.addressComponent.city;
    address += e.addressComponent.district;
    address += e.addressComponent.street;
    address += e.addressComponent.streetNumber;
    alert("当前定位地址为：" + address);
    });
    geolocationControl.addEventListener("locationError",function(e){
        // 定位失败事件
        alert(e.message);
    });
    map.addControl(geolocationControl);


    map.enableScrollWheelZoom();
    map.enableInertialDragging();

    map.enableContinuousZoom();

    var size = new BMap.Size(60, 20);
    map.addControl(new BMap.CityListControl({
        anchor: BMAP_ANCHOR_TOP_LEFT,
        offset: size,
        // 切换城市之间事件
        // onChangeBefore: function(){
        //    alert('before');
        // },
        // 切换城市之后事件
        // onChangeAfter:function(){
        //   alert('after');
        // }
    }));


});

function type_change(e) {
    if ($(e).val() == 1) {
        $('.union').show();
    } else {
        $('.union').hide();
    }
}

</script>
</body>
</html>